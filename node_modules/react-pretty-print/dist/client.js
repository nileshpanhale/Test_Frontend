const React = require('react');
const _ = require('underscore');

const InputMixin = {
  timeout: null,
  onInput: function(e) {
    e.persist();
    if (this.timeout) {
      clearTimeout(this.timeout);
    } else {
      this.props.onInputStart && this.props.onInputStart.apply(null, [e]);
    }
    this.timeout = setTimeout(function() {
      this.timeout = null;
      this.props.onInputEnd && this.props.onInputEnd.apply(null, [e]);
    }.bind(this), this.props.ttl || 1000);
  },
  attrs: function() {
    const attrs = _.clone(this.props);
    if (attrs.onInputStart || attrs.onInputEnd) {
      attrs.onInput = function(e) {
        this.onInput(e);
        this.props.onInput && this.props.onInput.apply(null, [e]);
      }.bind(this)
    }
    return attrs;
  }
};

const Input = React.createClass({displayName: "Input",
  mixins: [InputMixin],
  render: function() {
    return (React.createElement('input', this.attrs()));
  }
});

module.exports = { Input: Input };
